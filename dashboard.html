<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEBLUG â€“ Dashboard</title>
<link href="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js" rel="preload" as="script">
<style>
:root {
  --bg: #ffffff; --text: #111827; --muted: #6b7280; --border: #e5e7eb; --accent: #2563eb; --card: #f9fafb;
}
body.dark { --bg: #1e293b; --text: #f8fafc; --muted: #94a3b8; --border: #475569; --card: #0f172a; }
* { box-sizing:border-box; margin:0; padding:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
body { background: var(--bg); color: var(--text); min-height:100vh; padding-bottom:60px; }

header { display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--border); position:sticky; top:0; background: var(--bg); z-index:100; }
.logo { font-weight:700; font-size:18px; }
.icon-btn { background:none; border:none; cursor:pointer; color: var(--text); }

main { padding:16px; }

.card { background: var(--card); border-radius:8px; padding:12px; margin-bottom:12px; position:relative; }
.card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.username { font-weight:600; cursor:pointer; }
.stat { font-size:12px; color:var(--muted); display:flex; align-items:center; gap:4px; margin-right:12px; }

.delete-btn { position:absolute; top:8px; right:8px; background:red; color:white; border:none; border-radius:4px; padding:2px 6px; cursor:pointer; font-size:12px; }

nav { position:fixed; bottom:0; left:0; right:0; display:flex; justify-content:space-around; border-top:1px solid var(--border); background:var(--bg); padding:10px 0; }
nav a { text-decoration:none; color:var(--muted); font-size:11px; display:flex; flex-direction:column; align-items:center; gap:4px; }
nav a.active { color:var(--accent); }

</style>
</head>
<body>

<header>
  <div class="logo">DEBLUG</div>
  <button class="icon-btn" onclick="toggleTheme()"><i data-lucide="moon"></i></button>
</header>

<main id="postsContainer">
  <p style="text-align:center; color:var(--muted);">Loading your posts...</p>
</main>

<nav>
  <a href="fyp.html"><i data-lucide="home"></i>FYP</a>
  <a href="#"><i data-lucide="plus-square"></i>Post</a>
  <a href="action.html"><i data-lucide="bell"></i>Notify</a>
  <a href="chat.html"><i data-lucide="message-square"></i>Chat</a>
  <a href="#"><i data-lucide="user"></i>Profile</a>
</nav>

<script src="https://unpkg.com/lucide@latest"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, orderBy, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDCBD2gVIg9v-KqYaMFZeu_grgs3yKYfPs",
  authDomain: "fir-chat-f8d55.firebaseapp.com",
  projectId: "fir-chat-f8d55",
  storageBucket: "fir-chat-f8d55.firebasestorage.app",
  messagingSenderId: "792896094694",
  appId: "1:792896094694:web:dd373e5d7fc9ae1d5627"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const postsContainer = document.getElementById("postsContainer");
let currentUser;

onAuthStateChanged(auth, user => {
  if(!user){ window.location.href="login.html"; return; }
  currentUser = user;
  loadUserPosts();
});

async function loadUserPosts(){
  const q = query(collection(db,"posts"), where("uid","==",currentUser.uid), orderBy("timestamp","desc"));
  const snapshot = await getDocs(q);
  postsContainer.innerHTML = '';
  if(snapshot.empty){ postsContainer.innerHTML='<p style="text-align:center; color:var(--muted);">You have no posts yet.</p>'; return; }

  snapshot.forEach(docSnap=>{
    const post = docSnap.data();
    const postEl = document.createElement('div');
    postEl.className='card';
    postEl.innerHTML=`
      <div class="card-header">
        <span class="username">${post.username}</span>
        <div>
          <span class="stat"><i data-lucide="heart"></i> ${post.likes?.length||0}</span>
          <span class="stat"><i data-lucide="message-circle"></i> ${post.commentsCount||0}</span>
        </div>
      </div>
      <div class="content">${post.content.replace(/\n/g,'<br>')}</div>
      <button class="delete-btn" onclick="deletePost('${docSnap.id}')">Delete</button>
    `;
    postsContainer.appendChild(postEl);
  });

  lucide.createIcons();
}

async function deletePost(postId){
  if(confirm("Are you sure you want to delete this post?")){
    await deleteDoc(doc(db,"posts",postId));
    loadUserPosts();
  }
}

function toggleTheme(){
  document.body.classList.toggle('dark');
}
</script>

</body>
</html>
