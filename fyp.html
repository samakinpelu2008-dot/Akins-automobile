<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DEBLUG ‚Äì FYP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0d1117;
  color: white;
}
.post {
  border-bottom: 1px solid #222;
  padding: 15px;
}
.actions {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
button {
  background: none;
  border: none;
  color: #8b949e;
  cursor: pointer;
}
button:hover {
  color: white;
}
</style>
</head>

<body>

<div id="feed"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDCBD2gVIg9v-KqYaMFZeu_grgs3yKYfPs",
  authDomain: "fir-chat-f8d55.firebaseapp.com",
  projectId: "fir-chat-f8d55"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const feed = document.getElementById("feed");

onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  loadPosts();
});

function loadPosts() {
  // TEMP posts (we replace with Firestore later)
  const posts = [
    {id:"1", text:"Welcome to DEBLUG üöÄ This is the first post"},
    {id:"2", text:"This is another post on your FYP"}
  ];

  feed.innerHTML = "";
  posts.forEach(p => {
    const div = document.createElement("div");
    div.className = "post";
    div.innerHTML = `
      <div onclick="openPost('${p.id}')">${p.text}</div>
      <div class="actions">
        <button onclick="likePost('${p.id}', event)">‚ù§Ô∏è</button>
        <button onclick="followUser(event)">‚ûï Follow</button>
        <button onclick="sharePost('${p.id}', event)">üîó</button>
      </div>
    `;
    feed.appendChild(div);
  });
}

// GLOBAL handlers
window.openPost = (id) => {
  window.location.href = `post.html?id=${id}`;
};

window.likePost = (id, e) => {
  e.stopPropagation();
  fetch(`all.html?action=like&id=${id}`);
};

window.followUser = (e) => {
  e.stopPropagation();
  fetch(`all.html?action=follow`);
};

window.sharePost = (id, e) => {
  e.stopPropagation();
  navigator.share
    ? navigator.share({ text: "Check this post", url: location.href })
    : alert("Link copied!");
};
</script>

</body>
</html>
